{{- define "main" -}}
  <header class="pb-8 md:text-center">
    <h1 class="title text-3xl md:text-7xl font-black">
      {{- with .Title -}}
        {{- . -}}
        {{- else -}}
        {{- with .File -}}{{- .TranslationBaseName -}}{{- end -}}
      {{- end -}}
    </h1>
    {{/*  {{- if not .Date.IsZero -}}
      <div class="meta my-2 md:my-4 text-sm md:text-lg">
        <p class="font-medium">
          <time
            datetime="{{- .Date.Format .Site.Params.time.RFC3339 -}}"
            class="text-offset"
            >{{- .Date.Format .Site.Params.time.Short -}}</time
          >
        </p>
      </div>
    {{- end -}}
    {{- if not .Lastmod.IsZero -}}
      <div>
        <p class="italic md:text-right text-sm md:text-base">
          Last Update:
          <time
            datetime="{{- .Lastmod.Format .Site.Params.time.RFC3339 -}}"
            class="text-offset"
          >
            {{- .Lastmod.Format .Site.Params.time.Short -}}
          </time>
        </p>
      </div>
    {{- end -}}
    */}}
    {{/*  {{- with .Params.tags -}}
      <ul class="inline text-sm tracking-wide space-x-4">
        {{- range . -}}
          <li class="inline-block">
            <a
              class="underline text-primary"
              href="/tags/{{- . | urlize -}}"
              style="text-underline-offset: 2.5px;"
              ><span>#</span> {{- . | lower | urlize -}}</a
            >
          </li>
        {{- end -}}
      </ul>
    {{- end -}}
    */}}
  </header>
  <article>
    <div class="prose lg:prose-xl mx-auto">
      {{- partial "content" . -}}
    </div>
  </article>

  {{- $re := printf `\[{2}\s*(%s)\b\s*\|?\s*(|[^\]\|]+\S)(?:\s*)\]{2}` .File.BaseFileName -}}
  {{- $backlinks := slice -}}
  {{- range where .Site.AllPages ".Page.Permalink" "!=" .Page.Permalink -}}
    {{- if .Page.File -}}
      {{- if ne .Page.File.TranslationBaseName  "_index" -}}
        {{- if findRE $re .RawContent -}}
          {{- $backlinks = $backlinks | append . -}}
        {{- end -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}

  {{- with $backlinks -}}
    <aside class="my-8">
      <div
        class="backlinks bg-blue-700 space-y-4 bg-opacity-10 m-auto max-w-prose md:text-xl p-4 rounded-xl"
      >
        <header
          class="uppercase text-xl font-medium flex items-center space-x-1"
        >
          <svg viewBox="0 0 100 100" width="16" height="16" class="link">
            <path
              fill="currentColor"
              stroke="currentColor"
              d="M74,8c-4.8,0-9.3,1.9-12.7,5.3l-10,10c-2.9,2.9-4.7,6.6-5.1,10.6C46,34.6,46,35.3,46,36c0,2.7,0.6,5.4,1.8,7.8l3.1-3.1 C50.3,39.2,50,37.6,50,36c0-3.7,1.5-7.3,4.1-9.9l10-10c2.6-2.6,6.2-4.1,9.9-4.1s7.3,1.5,9.9,4.1c2.6,2.6,4.1,6.2,4.1,9.9 s-1.5,7.3-4.1,9.9l-10,10C71.3,48.5,67.7,50,64,50c-1.6,0-3.2-0.3-4.7-0.8l-3.1,3.1c2.4,1.1,5,1.8,7.8,1.8c4.8,0,9.3-1.9,12.7-5.3 l10-10C90.1,35.3,92,30.8,92,26s-1.9-9.3-5.3-12.7C83.3,9.9,78.8,8,74,8L74,8z M62,36c-0.5,0-1,0.2-1.4,0.6l-24,24 c-0.5,0.5-0.7,1.2-0.6,1.9c0.2,0.7,0.7,1.2,1.4,1.4c0.7,0.2,1.4,0,1.9-0.6l24-24c0.6-0.6,0.8-1.5,0.4-2.2C63.5,36.4,62.8,36,62,36 z M36,46c-4.8,0-9.3,1.9-12.7,5.3l-10,10c-3.1,3.1-5,7.2-5.2,11.6c0,0.4,0,0.8,0,1.2c0,4.8,1.9,9.3,5.3,12.7 C16.7,90.1,21.2,92,26,92s9.3-1.9,12.7-5.3l10-10C52.1,73.3,54,68.8,54,64c0-2.7-0.6-5.4-1.8-7.8l-3.1,3.1 c0.5,1.5,0.8,3.1,0.8,4.7c0,3.7-1.5,7.3-4.1,9.9l-10,10C33.3,86.5,29.7,88,26,88s-7.3-1.5-9.9-4.1S12,77.7,12,74 c0-3.7,1.5-7.3,4.1-9.9l10-10c2.6-2.6,6.2-4.1,9.9-4.1c1.6,0,3.2,0.3,4.7,0.8l3.1-3.1C41.4,46.6,38.7,46,36,46L36,46z"
            ></path>
          </svg>
          <h3 class="text-lg font-black md:text-xl">Enlaces a Ã©sta nota</h3>
        </header>
        <ul class="list-inside text-base md:text-lg">
          {{- range . -}}
            {{- $backlink := "" -}}
            {{- if eq .Page.File.ContentBaseName "_index" -}}
              {{- $backlink = "Inicio" -}}
              {{- else -}}
              {{- $backlink = .Page.File.ContentBaseName -}}
            {{- end -}}
            <li>
              <a
                href="{{- with .RelPermalink -}}{{- . -}}{{- else -}}/{{- end -}}"
                class="backlink"
                >{{- $backlink -}}</a
              >
            </li>
          {{- end -}}
        </ul>
      </div>
    </aside>
  {{- end -}}
{{- end -}}
