{{- if or (hasPrefix .Destination "http") (hasPrefix .Destination "mailto") -}}
  <a href="{{- .Destination | safeURL -}}" {{- with .Title -}} title="{{- . -}}" {{- end -}} {{- if not (in .Destination "algus.ninja" ) -}} class="external" {{- end -}}>
    {{- .Text | safeHTML -}}</a>
{{- else -}}
  {{- $text := .Text -}}
  {{- $prettyText := split $text "#" -}}

  {{/* create anchor and filename */}}
  {{- $anchor := "" -}}
  {{- $destination := split .Destination "#" -}}
  {{- $filename := (index $destination 0) -}}
  {{- $anchor = urlize $filename -}}

  {{/* concatenate anchor if link has heading link */}}
  {{- with (index $destination 1) -}}
    {{- $anchor = . | anchorize | printf "%s#%s" $anchor -}}
  {{- end -}}

  {{/* custom text (when using `|` on links) has priority than `title` from front matter */}}
  {{- if ne .Destination .Text -}} 
    {{ $text = $text | safeHTML -}}
  {{- else -}}
    {{- with (.Page.GetPage $filename).Title -}}
      {{- $text = . | safeHTML -}}
    {{- else -}}
      {{ $text = $text | safeHTML -}}
    {{- end -}}
  {{end}}

  {{- if fileExists ($filename | printf "%s/%s.md" .Page.Site.Params.notesPath) -}}
    <a href="{{- $anchor | relURL -}}" {{- with .Title -}} title="{{- . -}}" {{- end -}}>
      {{- $text -}}
    </a>
  {{- else -}}
    <a href="javascript:void(0)" {{- with .Title -}} title="{{- . -}}" {{- end -}} class="dead-end">
      {{- .Text | safeHTML -}}</a>
  {{- end -}}
{{- end -}}